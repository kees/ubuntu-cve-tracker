PublicDateAtUSN: 2020-04-06 16:00:00 UTC
Candidate: CVE-2020-8834
CRD: 2020-04-06 16:00:00 UTC
PublicDate: 2020-04-09 22:15:00 UTC
References:
 https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8834
 https://www.openwall.com/lists/oss-security/2020/04/06/2
 https://ubuntu.com/security/notices/USN-4318-1
Description:
 KVM in the Linux kernel on Power8 processors has a conflicting use of
 HSTATE_HOST_R1 to store r1 state in kvmppc_hv_entry plus in
 kvmppc_{save,restore}_tm, leading to a stack corruption. Because of this,
 an attacker with the ability run code in kernel space of a guest VM can
 cause the host kernel to panic. There were two commits that, according to
 the reporter, introduced the vulnerability: f024ee098476 ("KVM: PPC: Book3S
 HV: Pull out TM state save/restore into separate procedures") 87a11bb6a7f7
 ("KVM: PPC: Book3S HV: Work around XER[SO] bug in fake suspend mode") The
 former landed in 4.8, the latter in 4.17. This was fixed without realizing
 the impact in 4.18 with the following three commits, though it's believed
 the first is the only strictly necessary commit: 6f597c6b63b6 ("KVM: PPC:
 Book3S PR: Add guest MSR parameter for
 kvmppc_save_tm()/kvmppc_restore_tm()") 7b0e827c6970 ("KVM: PPC: Book3S HV:
 Factor fake-suspend handling out of kvmppc_save/restore_tm") 009c872a8bc4
 ("KVM: PPC: Book3S PR: Move kvmppc_save_tm/kvmppc_restore_tm to separate
 file")
Ubuntu-Description:
 Gustavo Romero and Paul Mackerras discovered that the KVM implementation in
 the Linux kernel for PowerPC processors did not properly keep guest state
 separate from host state. A local attacker in a KVM guest could use this to
 cause a denial of service (host system crash).
Notes:
 sbeattie> appears to only affect Power8 hardware and not Power9,
   possibly because transaction memory in Power9 needs a software assist
   to function.
 sbeattie> from reporter, introduced in f024ee098476 and exacerbated by
   87a11bb6a7f7.
 sbeattie| Addressed by:
   7b0e827c6970e8ca77c60ae87592204c39e41245 KVM: PPC: Book3S HV: Factor
     fake-suspend handling out of kvmppc_save/restore_tm
   009c872a8bc4d38f487a9bd62423d019e4322517 KVM: PPC: Book3S PR: Move
     kvmppc_save_tm/kvmppc_restore_tm to separate file
   6f597c6b63b6f3675914b5ec8fcd008a58678650 KVM: PPC: Book3S PR: Add
     guest MSR parameter for kvmppc_save_tm()/kvmppc_restore_tm()
Mitigation: 
Bugs: 
 https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717
Priority: medium
Discovered-by: Gustavo Romero and Paul Mackerras
Assigned-to: 
CVSS:
 ubuntu: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:N/I:N/A:H [6.5 MEDIUM]
 nvd: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:N/I:N/A:H [6.5 MEDIUM]

Patches_linux:
 break-fix: f024ee098476a3e620232e4a78cfac505f121245 7b0e827c6970e8ca77c60ae87592204c39e41245
 break-fix: f024ee098476a3e620232e4a78cfac505f121245 009c872a8bc4d38f487a9bd62423d019e4322517
 break-fix: f024ee098476a3e620232e4a78cfac505f121245 6f597c6b63b6f3675914b5ec8fcd008a58678650
upstream_linux: released (4.18~rc1)
precise/esm_linux: not-affected (v4.15 kernels only)
trusty_linux: ignored (out of standard support)
trusty/esm_linux: not-affected (v4.15 kernels only)
xenial_linux: not-affected (v4.15 kernels only)
esm-infra/xenial_linux: not-affected (v4.15 kernels only)
bionic_linux: released (4.15.0-96.97)
eoan_linux: not-affected (v4.15 kernels only)
devel_linux: not-affected (v4.15 kernels only)

Patches_linux-hwe:
upstream_linux-hwe: released (4.18~rc1)
precise/esm_linux-hwe: DNE
trusty_linux-hwe: DNE
trusty/esm_linux-hwe: DNE
xenial_linux-hwe: released (4.15.0-96.97~16.04.1)
esm-infra/xenial_linux-hwe: released (4.15.0-96.97~16.04.1)
bionic_linux-hwe: not-affected (v4.15 kernels only)
eoan_linux-hwe: DNE
devel_linux-hwe: DNE

Patches_linux-hwe-edge:
upstream_linux-hwe-edge: released (4.18~rc1)
precise/esm_linux-hwe-edge: DNE
trusty_linux-hwe-edge: DNE
trusty/esm_linux-hwe-edge: DNE
xenial_linux-hwe-edge: ignored (was needs-triage now end-of-life)
esm-infra/xenial_linux-hwe-edge: ignored (was needs-triage now end-of-life)
bionic_linux-hwe-edge: not-affected (v4.15 kernels only)
eoan_linux-hwe-edge: DNE
devel_linux-hwe-edge: DNE

Patches_linux-lts-xenial:
upstream_linux-lts-xenial: released (4.18~rc1)
precise/esm_linux-lts-xenial: DNE
trusty_linux-lts-xenial: ignored (out of standard support)
trusty/esm_linux-lts-xenial: not-affected (v4.15 kernels only)
xenial_linux-lts-xenial: DNE
bionic_linux-lts-xenial: DNE
eoan_linux-lts-xenial: DNE
devel_linux-lts-xenial: DNE

Patches_linux-lts-trusty:
upstream_linux-lts-trusty: released (4.18~rc1)
precise/esm_linux-lts-trusty: not-affected (v4.15 kernels only)
trusty_linux-lts-trusty: DNE
trusty/esm_linux-lts-trusty: DNE
xenial_linux-lts-trusty: DNE
bionic_linux-lts-trusty: DNE
eoan_linux-lts-trusty: DNE
devel_linux-lts-trusty: DNE

Patches_linux-oem:
upstream_linux-oem: released (4.18~rc1)
precise/esm_linux-oem: DNE
trusty_linux-oem: DNE
trusty/esm_linux-oem: DNE
xenial_linux-oem: not-affected (v4.15 kernels only)
bionic_linux-oem: not-affected (ppc kernels only)
eoan_linux-oem: not-affected (ppc kernels only)
devel_linux-oem: DNE

Patches_linux-oem-osp1:
upstream_linux-oem-osp1: released (4.18~rc1)
precise/esm_linux-oem-osp1: DNE
trusty_linux-oem-osp1: DNE
trusty/esm_linux-oem-osp1: DNE
xenial_linux-oem-osp1: DNE
bionic_linux-oem-osp1: not-affected (v4.15 kernels only)
eoan_linux-oem-osp1: not-affected (v4.15 kernels only)
devel_linux-oem-osp1: DNE

Patches_linux-kvm:
upstream_linux-kvm: released (4.18~rc1)
precise/esm_linux-kvm: DNE
trusty_linux-kvm: DNE
trusty/esm_linux-kvm: DNE
xenial_linux-kvm: not-affected (v4.15 kernels only)
esm-infra/xenial_linux-kvm: not-affected (v4.15 kernels only)
bionic_linux-kvm: not-affected (ppc kernels only)
eoan_linux-kvm: not-affected (v4.15 kernels only)
devel_linux-kvm: not-affected (v4.15 kernels only)

Patches_linux-aws:
upstream_linux-aws: released (4.18~rc1)
precise/esm_linux-aws: DNE
trusty_linux-aws: ignored (out of standard support)
trusty/esm_linux-aws: not-affected (v4.15 kernels only)
xenial_linux-aws: not-affected (v4.15 kernels only)
esm-infra/xenial_linux-aws: not-affected (v4.15 kernels only)
bionic_linux-aws: not-affected (ppc kernels only)
eoan_linux-aws: not-affected (v4.15 kernels only)
devel_linux-aws: not-affected (v4.15 kernels only)

Patches_linux-aws-5.0:
upstream_linux-aws-5.0: released (4.18~rc1)
precise/esm_linux-aws-5.0: DNE
trusty_linux-aws-5.0: DNE
trusty/esm_linux-aws-5.0: DNE
xenial_linux-aws-5.0: DNE
bionic_linux-aws-5.0: not-affected (v4.15 kernels only)
eoan_linux-aws-5.0: DNE
devel_linux-aws-5.0: DNE

Patches_linux-aws-hwe:
upstream_linux-aws-hwe: released (4.18~rc1)
precise/esm_linux-aws-hwe: DNE
trusty_linux-aws-hwe: DNE
trusty/esm_linux-aws-hwe: DNE
xenial_linux-aws-hwe: not-affected (ppc kernels only)
esm-infra/xenial_linux-aws-hwe: not-affected (ppc kernels only)
bionic_linux-aws-hwe: DNE
eoan_linux-aws-hwe: DNE
devel_linux-aws-hwe: DNE

Patches_linux-azure:
upstream_linux-azure: released (4.18~rc1)
precise/esm_linux-azure: DNE
trusty_linux-azure: ignored (out of standard support)
trusty/esm_linux-azure: not-affected (ppc kernels only)
xenial_linux-azure: not-affected (ppc kernels only)
esm-infra/xenial_linux-azure: not-affected (ppc kernels only)
bionic_linux-azure: not-affected (v4.15 kernels only)
eoan_linux-azure: not-affected (v4.15 kernels only)
devel_linux-azure: not-affected (v4.15 kernels only)

Patches_linux-azure-5.3:
upstream_linux-azure-5.3: released (4.18~rc1)
precise/esm_linux-azure-5.3: DNE
trusty_linux-azure-5.3: DNE
trusty/esm_linux-azure-5.3: DNE
xenial_linux-azure-5.3: DNE
bionic_linux-azure-5.3: not-affected (v4.15 kernels only)
eoan_linux-azure-5.3: DNE
devel_linux-azure-5.3: DNE

Patches_linux-azure-edge:
upstream_linux-azure-edge: released (4.18~rc1)
precise/esm_linux-azure-edge: DNE
trusty_linux-azure-edge: DNE
trusty/esm_linux-azure-edge: DNE
xenial_linux-azure-edge: not-affected (ppc kernels only)
bionic_linux-azure-edge: not-affected (v4.15 kernels only)
eoan_linux-azure-edge: DNE
devel_linux-azure-edge: DNE

Patches_linux-gcp:
upstream_linux-gcp: released (4.18~rc1)
precise/esm_linux-gcp: DNE
trusty_linux-gcp: DNE
trusty/esm_linux-gcp: DNE
xenial_linux-gcp: not-affected (ppc kernels only)
esm-infra/xenial_linux-gcp: not-affected (ppc kernels only)
bionic_linux-gcp: not-affected (v4.15 kernels only)
eoan_linux-gcp: not-affected (v4.15 kernels only)
devel_linux-gcp: not-affected (v4.15 kernels only)

Patches_linux-gcp-5.3:
upstream_linux-gcp-5.3: released (4.18~rc1)
precise/esm_linux-gcp-5.3: DNE
trusty_linux-gcp-5.3: DNE
trusty/esm_linux-gcp-5.3: DNE
xenial_linux-gcp-5.3: DNE
bionic_linux-gcp-5.3: not-affected (v4.15 kernels only)
eoan_linux-gcp-5.3: DNE
devel_linux-gcp-5.3: DNE

Patches_linux-gcp-edge:
upstream_linux-gcp-edge: released (4.18~rc1)
precise/esm_linux-gcp-edge: DNE
trusty_linux-gcp-edge: DNE
trusty/esm_linux-gcp-edge: DNE
xenial_linux-gcp-edge: DNE
bionic_linux-gcp-edge: not-affected (v4.15 kernels only)
eoan_linux-gcp-edge: DNE
devel_linux-gcp-edge: DNE

Patches_linux-gke-4.15:
upstream_linux-gke-4.15: released (4.18~rc1)
precise/esm_linux-gke-4.15: DNE
trusty_linux-gke-4.15: DNE
trusty/esm_linux-gke-4.15: DNE
xenial_linux-gke-4.15: DNE
bionic_linux-gke-4.15: not-affected (ppc kernels only)
eoan_linux-gke-4.15: DNE
devel_linux-gke-4.15: DNE

Patches_linux-gke-5.0:
upstream_linux-gke-5.0: released (4.18~rc1)
precise/esm_linux-gke-5.0: DNE
trusty_linux-gke-5.0: DNE
trusty/esm_linux-gke-5.0: DNE
xenial_linux-gke-5.0: DNE
bionic_linux-gke-5.0: not-affected (v4.15 kernels only)
eoan_linux-gke-5.0: DNE
devel_linux-gke-5.0: DNE

Patches_linux-oracle:
upstream_linux-oracle: released (4.18~rc1)
precise/esm_linux-oracle: DNE
trusty_linux-oracle: DNE
trusty/esm_linux-oracle: DNE
xenial_linux-oracle: not-affected (ppc kernels only)
esm-infra/xenial_linux-oracle: not-affected (ppc kernels only)
bionic_linux-oracle: not-affected (ppc kernels only)
eoan_linux-oracle: not-affected (v4.15 kernels only)
devel_linux-oracle: not-affected (v4.15 kernels only)

Patches_linux-oracle-5.0:
upstream_linux-oracle-5.0: released (4.18~rc1)
precise/esm_linux-oracle-5.0: DNE
trusty_linux-oracle-5.0: DNE
trusty/esm_linux-oracle-5.0: DNE
xenial_linux-oracle-5.0: DNE
bionic_linux-oracle-5.0: not-affected (v4.15 kernels only)
eoan_linux-oracle-5.0: DNE
devel_linux-oracle-5.0: DNE

Patches_linux-raspi2:
upstream_linux-raspi2: released (4.18~rc1)
precise/esm_linux-raspi2: DNE
trusty_linux-raspi2: DNE
trusty/esm_linux-raspi2: DNE
xenial_linux-raspi2: not-affected (ppc kernels only)
bionic_linux-raspi2: not-affected (ppc kernels only)
esm-apps/bionic_linux-raspi2: not-affected (ppc kernels only)
eoan_linux-raspi2: not-affected (ppc kernels only)
devel_linux-raspi2: not-affected (ppc kernels only)

Patches_linux-snapdragon:
upstream_linux-snapdragon: released (4.18~rc1)
precise/esm_linux-snapdragon: DNE
trusty_linux-snapdragon: DNE
trusty/esm_linux-snapdragon: DNE
xenial_linux-snapdragon: not-affected (ppc kernels only)
bionic_linux-snapdragon: not-affected (ppc kernels only)
eoan_linux-snapdragon: DNE
devel_linux-snapdragon: DNE

Patches_linux-raspi2-5.3:
upstream_linux-raspi2-5.3: released (4.18~rc1)
precise/esm_linux-raspi2-5.3: DNE
trusty_linux-raspi2-5.3: DNE
trusty/esm_linux-raspi2-5.3: DNE
xenial_linux-raspi2-5.3: DNE
bionic_linux-raspi2-5.3: not-affected (ppc kernels only)
eoan_linux-raspi2-5.3: DNE
devel_linux-raspi2-5.3: DNE

Patches_linux-oem-5.4:
upstream_linux-oem-5.4: released (4.18~rc1)
precise/esm_linux-oem-5.4: DNE
trusty_linux-oem-5.4: DNE
trusty/esm_linux-oem-5.4: DNE
xenial_linux-oem-5.4: DNE
bionic_linux-oem-5.4: DNE
eoan_linux-oem-5.4: DNE
devel_linux-oem-5.4: not-affected (v4.15 kernels only)

Patches_linux-gke-5.3:
upstream_linux-gke-5.3: released (4.18~rc1)
precise/esm_linux-gke-5.3: DNE
trusty_linux-gke-5.3: DNE
trusty/esm_linux-gke-5.3: DNE
xenial_linux-gke-5.3: DNE
bionic_linux-gke-5.3: not-affected (v4.15 kernels only)
eoan_linux-gke-5.3: DNE
devel_linux-gke-5.3: DNE

Patches_linux-oracle-5.3:
upstream_linux-oracle-5.3: released (4.18~rc1)
precise/esm_linux-oracle-5.3: DNE
trusty_linux-oracle-5.3: DNE
trusty/esm_linux-oracle-5.3: DNE
xenial_linux-oracle-5.3: DNE
bionic_linux-oracle-5.3: not-affected (v4.15 kernels only)
eoan_linux-oracle-5.3: DNE
devel_linux-oracle-5.3: DNE
