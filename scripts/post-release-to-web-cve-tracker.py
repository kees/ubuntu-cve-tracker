#!/usr/bin/python3
# Standard library

# I'm storing this here for the moment because I'm not sure where else to store it.

# attempting to use this script to update hirsute's status to being
# released failed, see
# https://github.com/canonical-web-and-design/ubuntu.com/issues/9617


import argparse
import json
import os
from http.cookiejar import MozillaCookieJar

# Local
from macaroonbakery import httpbakery

raise Exception("Remove this line and update 27-35 with data about the new devel release.")


def authentication(payload, do_update):

    url = 'https://ubuntu.com/security/releases'

    if do_update:
        request = "PUT"
        url += "/%s.json" % payload['codename']
    else:
        request = "POST"

    client = httpbakery.Client(cookies=MozillaCookieJar(".login"))

    if os.path.exists(client.cookies.filename):
        client.cookies.load(ignore_discard=True)

    response = client.request(request, url=url, json=payload)
    client.cookies.save(ignore_discard=True)
    print(response, response.text)


groovy_release = {
    "name": "Groovy Gorilla",
    "version": "20.10",
    "codename": "groovy",
    "development": False,
    "lts": False,
    "esm_expires": "2021-07-31T00:00:00",
    "release_date": "2020-10-20T00:00:00",
    "support_expires": "2021-07-31T00:00:00",
}

hirsute_release = {
    "name": "Hirsute Hippo",
    "version": "21.04",
    "codename": "hirsute",
    "lts": "False",
    "development": "False",
    "release_date": "2021-04-22",
    "esm_expires": "2022-01-31",
    "support_expires": "2022-01-31",
}

impish_devel = {
    "name": "Impish Indri",
    "version": "21.10",
    "codename": "impish",
    "lts": "False",
    "development": "True",
    "release_date": "2021-10-14",
    "esm_expires": "2022-07-31",
    "support_expires": "2022-07-31",
}


def main():

    parser = argparse.ArgumentParser(description="CLI to post Ubuntu Releases")
    parser.add_argument("--update", action="store_true", help="update release instead of add")
    args = parser.parse_args()

    print(groovy_release)
    print(json.dumps(groovy_release, indent=2))
    authentication(groovy_release, args.update)


if __name__ == "__main__":
    main()
