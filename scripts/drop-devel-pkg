#!/bin/bash
#
# Copyright (C) 2010-2023 Canonical Ltd.
#
# This script is distributed under the terms and conditions of the GNU General
# Public License, Version 3 or later. See http://www.gnu.org/copyleft/gpl.html
# for details.
#
# Handy script to remove a package from the devel release.
# TODO: replace with invocation of mass-cve-edit
for pkg in "$@"; do
    perl -pi -e 's/^(devel_'"$pkg"':).*/$1 DNE/;' active/CVE-*
    if [ -d "$(readlink embargoed)" ] ; then
        perl -pi -e 's/^(devel_'"$pkg"':).*/$1 DNE/;' embargoed/CVE-*
    fi
    # search through the boilerplates to remove devel entries, but make
    # sure only to touch actual files and not symlinks
    find boilerplates/ -maxdepth 1 -type f -print0 | xargs -0 perl -pi -e 's/^(devel_'"$pkg"':).*/$1 DNE/;'
done

echo "== changed files =="
git status -uno --porcelain

if [ -d "$(readlink embargoed)" ] ; then
    echo
    echo "== changed embargoed files =="
    (cd embargoed && git status -uno --porcelain)
fi
